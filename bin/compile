#!/usr/bin/env bash

# bin/compile <build-dir> <cache-dir> <env-dir>

BUILD_DIR=$1
cd $BUILD_DIR

echo $BUILD_DIR
pwd

mkdir -p .heroku/swift
ls

SWIFT_RELEASE_URL="https://swift.org/builds/ubuntu1404/swift-2.2-SNAPSHOT-2015-12-01-b/swift-2.2-SNAPSHOT-2015-12-01-b-ubuntu14.04.tar.gz"

# we need to run things in here, set it up!
mkdir -p /app/.heroku
ln -s $BUILD_DIR/.heroku/swift /app/.heroku/swift
export PATH=/app/.heroku/swift/bin:$PATH

echo "Downloading Release and extracting..."
curl --silent --location "$SWIFT_RELEASE_URL" | tar xzf -C $BUILD_DIR/.heroku/swift

export PATH=/path/to/usr/bin:"${PATH}"
